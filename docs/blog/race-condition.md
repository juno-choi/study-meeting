# 🔴 Critical Section과 Race Condition

## 🟠 임계구역 (critical section)

2개 이상의 프로세스 or 쓰레드가 공유 자원에 접근할 때 순서 등의 이유로 결과가 달라지는 코드의 영역을 말한다.

## 🟠 경쟁 조건 (race condition)

2개 이상의 프로세스 or 쓰레드가 공유 자원에 접근할 때 접근 순서등에 따라 결과가 달라지는 상황을 말한다.

동시성 문제라고도 한다.

동시성 문제를 해결하기 위한 방법으로는 뮤텍스(Mutex), 세마포어(Semaphore), 모니터(monitor)가 있다. 모든 방법은 lock 매커니즘을 기반으로 한다.

## 🟠 헤결 방법

### 🟢 Mutex

![](https://velog.velcdn.com/images/octo__/post/e268ce48-d4ce-4e35-8c25-d188c5718fa1/image.png)

프로세스나 쓰레드가 공유 자원을 lock()을 통해 잠금 설정하고 사용한 후에는 unlock()을 통해 잠금 해제하는 방법이다.

잠금이 설정되면 다른 프로세스나 쓰레드는 잠긴 코드 영역에 접근할 수 없다.

뮤텍스는 잠금 또는 잠금 해제라는 상태만 갖는다.

### 🟢 Semaphore

![](https://velog.velcdn.com/images/octo__/post/ec806c01-05bc-4260-a198-466e775e3835/image.png)

일반화된 뮤텍스이다. 간단한 정수 값과 두 가지 함수 wait(), signal로 공유 자원에 대한 접근을 처리한다.

wait()은 자신의 차례가 올 때까지 기다리는 함수이고, signal()은 다음 프로세스로 순서를 넘겨주는 함수이다.

공유 자원에 접근하면 세마포어에서 wait() 작업을 수행하고 작업이 종료되면 세마포어에서 signal() 작업을 수행한다. 

세마포어에는 조건 변수가 없고 접근한 프로세스나 쓰레드가 세마포어 값을 수정할 때 다른 프로세스나 쓰레드는 동시에 세마포어 값을 수정할 수 없다.

`바이너리 세마포어`

0,1 두가지 값만 가질 수 있는 세마포어다.

바이너리 세마포어는 어떻게 보면 lock과 unlock 상태를 가지는 뮤텍스와 동일하다고 볼 수 있다.

하지만 엄밀히 말하면 뮤텍스는 잠금 기반으로 상호배제가 일어나는 잠금 매너니즘이고

세마포어는 신호를 기반으로 상호배제가 일어나는 신호 매커니즘이다.

`카운팅 세마포어`

여러 개의 값을 가질 수 있는 세마포어이다.

여러 자원에 대한 접근을 제어하는데 사용된다.

### 🟢 실무에서 사용되는 Redis lock

실무에서 사용되는 Redis를 통한 Lock은 하나의 자원에 여러 쓰레드가 접근하지 못하도록 lock 상태값에 따라 처뢰되므로 뮤텍스 기법이라 할 수 있다.
