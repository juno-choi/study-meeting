# 🔴 모메인 모델 시작하기

## 🟠 도메인

### 🟢 도메인이란?

```mermaid
flowchart LR
    A[주문] --> B[결제]
    A --> C[배송]
    A --> D[정산]
    A --> E[카탈로그]
    E --> F[리뷰]
    A --> G[회원]
    A --> H[혜택]
    H --> A
```

예를 들어 온라인 서점 도메인은 소프트웨어로 해결하고자 하는 문제 영역, 즉 도메인에 해당한다.
한 도메인은 다시 하위 도메인으로 나눌 수 있다. 서점 도메인은 다음과 같이 나눌 수 있다.

### 🟢 도메인 전문가와 개발자 간 지식 공유

```
Garbage in, Garbage out
```

개발자는 고객이 원하는 요구사항을 분석하고 설계하여 코드를 작성하며 테스트하고 배포한다. 요구사항을 올바르게 이해하려면 어떻게 해야 하나? 여러 방법이 있겠지만 비교적 간단한 방법이 있다.

그것은 바로 개발자와 전문가가 직접 대화하는 것이다.

개발자와 전문가 사이에 내용을 전파하는 전달자가 많으면 많을수록 정보가 왜곡되고 손실이 발생하게 되며, 개발자는 최초에 고객이 요구한 것과는 다른 무언가를 만들게 된다.

### 🟢 도메인 모델

```mermaid
classDiagram
    Order -- OrderLine
    Order -- ShippingInfo
    
    class Order{
        +String orderNumber
        +Money totalAmounts
        +changeShipping()
        +cancel()
    }

    class OrderLine{
        +Money price
        +int quantity
        +amounts()
    }
    class ShippingInfo{
        +String address
        +String message
    }
```

도메인 모델은 다음과 같이 객체 기반 주문 도메인 모델링이다.

```mermaid
---
title: Simple sample
---
stateDiagram-v2
    [*] --> 주문전
    주문전 --> 결제_대기중: 주문함[결제안함]
    주문전 --> 상품_준비_중: 주문함[결제함]
    결제_대기중 --> 상품_준비_중: 결제함
    상품_준비_중 --> 출고_완료됨: 택배사에서 상품 수령함
    출고_완료됨 --> 배송중: 배송 시작함
    배송중 --> 배송_완료: 고객 수령함
    상품_준비_중 --> 주문_취소_됨: 주문 취소함/결제 취소
    결제_대기중 --> 주문_취소_됨: 주문 취소함
    주문_취소_됨 --> [*]
    배송_완료 --> [*]
```

상태 다이어그램으로 모델링할 수도 있다.

### 🟢 도메인 모델 패턴

| 구성 | 영역 | 설명 |
|-------|-------|-------|
| Presentation | 사용자 인터페이스 또는 표현 | 사용자의 요청을 처리하고 사용자에게 정보를 보여준다. 여기서 사용자는 client 이거나 외부 시스템일 수 있다. |
| Application | 응용 | 사용자가 요청한 기능을 실행한다. 서비스 로직을 직접 구현하지 않으며 도메인 계층을 조합해서 기능을 실행한다. |
| Domain | 도메인 | 시스템이 제공할 도메인 규칙을 구현한다. |
| Infrastructure | 인프라스트럭쳐 | DB나 Message Queue 같은 외부 시스템과의 연동을 처리한다. |

`개념 모델` 순수하게 문제를 분석하여 작성된 결과물이다. 

`구현 모델` 개념 모델을 작성하고 점진적으로 개선해 나가며 얻은 도메인 지식을 통해 발전시킨 모델이다.

### 🟢 도메인 모델 도출

```
최소 한 종류 이상의 상품을 주문해야 한다.
한 상품을 한 개 이상 주문할 수 있다.
총 주문 금액은 각 상품의 구매 가격 합을 모두 더한 금액이다.
각 상품의 구매 가격 합은 상품 가격에 구매 개수를 곱한 값이다.
주문할 때 배송지 정보를 반드시 지정해야 한다.
배송지 정보는 받는 사람 이름, 전화번호, 주소로 구성된다.
출고를 하면 배송지를 변경할 수 없다.
출고 전에 주문을 취소할 수 있다.
고객이 결제를 완료하기 전에는 상품을 준비하지 않는다.
```

다음과 같은 요구사항이 있을때 요구사항에 맞춰 도메인을 점진적으로 진화시키는 과정을 도메인 모델 도출이라 한다.

```
한 상품을 한 개 이상 주문할 수 있다.
각 상품의 구매 가격 합은 상품 가격에 구매 개수를 곱한 값이다.
```

다음 요구사항은 주문 항목이 어떤 데이터로 구성되는지 알려준다. 

두 요구사항에 따르면 OrderLine은 적어도 주문할 상품, 상품의 가격, 구매 개수를 포함하애 한다.

```
최소 한 종류 이상의 상푸을 주문해야 한다.
총 주문 금액은 각 상품의 구매 가격 합을 모두 더한 금액이다.
```

다음 요구사항은 Order와 OrderLine과의 관계를 알려준다.

한 종류 이상의 상품을 주문할 수 있으므로 Order는 최소 한 개 이상의 OrderLine을 포함해야 한다. 또한 총 주문 금액은 OrderLine에서 구할 수 있다.

이렇듯 요구사항들을 분석하여 초기 모델에서 점진적으로 모델을 구현해가는 것을 도메인 모델 도출 과정이라 한다.

## 🟠 도메인모델

## 🟠 엔티티와 밸류

## 🟠 도메인 용어
